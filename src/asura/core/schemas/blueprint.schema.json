{
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "$id": "https://asura.local/schemas/blueprint.schema.json",
    "title": "ASURA Blueprint Schema (v0.1)",
    "type": "object",
    "additionalProperties": false,
    "required": ["schema_version", "document_id", "theme_id", "toc", "slides"],
    "properties": {
      "schema_version": { "type": "string", "const": "0.1" },
      "document_id": { "type": "string", "pattern": "^[a-zA-Z0-9_\\-]{1,64}$" },
      "theme_id": { "type": "string", "pattern": "^[a-zA-Z0-9_\\-]{1,64}$" },
      "toc": {
        "type": "array",
        "items": { "$ref": "#/$defs/toc_item" }
      },
      "slides": {
        "type": "array",
        "minItems": 1,
        "maxItems": 100,
        "items": { "$ref": "#/$defs/slide" }
      }
    },
    "$defs": {
      "bbox_pt": {
        "type": "array",
        "minItems": 4,
        "maxItems": 4,
        "items": { "type": "number" }
      },
      "color_rgb": {
        "type": "string",
        "pattern": "^#[0-9A-Fa-f]{6}$"
      },
      "layout_element": {
        "type": "object",
        "additionalProperties": true,
        "required": ["id", "kind", "bbox_pt"],
        "properties": {
          "id": { "type": "string", "pattern": "^[a-zA-Z0-9_\\-]{1,64}$" },
          "kind": {
            "type": "string",
            "enum": ["text", "image", "shape", "table", "group", "line"]
          },
          "bbox_pt": { "$ref": "#/$defs/bbox_pt" },
          "z": { "type": "integer" },
          "rotation_deg": { "type": "number" },

          "text": { "type": "string" },
          "text_struct": { "type": "object", "additionalProperties": true },

          "style": {
            "type": "object",
            "additionalProperties": true,
            "properties": {
              "font_family": { "type": "string" },
              "font_size_pt": { "type": "number" },
              "bold": { "type": "boolean" },
              "italic": { "type": "boolean" },
              "underline": { "type": "boolean" },
              "strike": { "type": "boolean" },
              "color": { "$ref": "#/$defs/color_rgb" },
              "fill": { "$ref": "#/$defs/color_rgb" },
              "stroke": { "$ref": "#/$defs/color_rgb" },
              "stroke_width_pt": { "type": "number" },
              "align": { "type": "string", "enum": ["left", "center", "right", "justify"] }
            }
          },

          "image": {
            "type": "object",
            "additionalProperties": true,
            "properties": {
              "bytes_b64": { "type": "string" },
              "content_type": { "type": "string" },
              "fit": { "type": "string", "enum": ["contain", "cover", "stretch"] },
              "crop": { "type": "object", "additionalProperties": true }
            }
          },

          "table": { "type": "object", "additionalProperties": true },
          "children": {
            "type": "array",
            "items": { "$ref": "#/$defs/layout_element" }
          }
        }
      },
      "citation": {
        "type": "object",
        "additionalProperties": false,
        "required": ["mark", "page", "chunk_id"],
        "properties": {
          "mark": { "type": "string", "pattern": "^â€»[0-9]+$" },
          "page": { "type": "integer", "minimum": 1 },
          "chunk_id": { "type": "string", "pattern": "^[a-zA-Z0-9_\\-]{1,64}$" },
          "bbox_pt": { "$ref": "#/$defs/bbox_pt" },
          "bbox": { "$ref": "#/$defs/bbox_pt" }
        }
      },
      "slot_value": {
        "oneOf": [
          { "type": "string" },
          {
            "type": "array",
            "items": { "type": "string" }
          }
        ]
      },
      "slide": {
        "type": "object",
        "additionalProperties": false,
        "required": ["component_id", "slots", "citations"],
        "properties": {
          "slide_no": { "type": ["integer", "null"], "minimum": 1 },
          "component_id": { "type": "string", "pattern": "^[a-zA-Z0-9_\\-]{1,64}$" },
          "message": { "type": "string" },
          "quality_flags": {
            "type": "array",
            "items": { "type": "string", "minLength": 1 }
          },
          "slots": {
            "type": "object",
            "additionalProperties": { "$ref": "#/$defs/slot_value" }
          },
          "citations": {
            "type": "array",
            "minItems": 1,
            "items": { "$ref": "#/$defs/citation" }
          },
          "layout_elements": {
            "type": "array",
            "items": { "$ref": "#/$defs/layout_element" }
          }
        }
      },
      "toc_item": {
        "type": "object",
        "additionalProperties": false,
        "required": ["title", "level"],
        "properties": {
          "title": { "type": "string", "minLength": 1 },
          "level": { "type": "integer", "minimum": 0, "maximum": 10 },
          "slide_index": { "type": ["integer", "null"], "minimum": 1 }
        }
      }
    }
  }